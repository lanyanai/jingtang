/**
 * Created by zd on 2014/7/12 0012.
 */
var product = [
    {"resId":632,"resLocation":"http://118.244.202.119/upload/20140711-133481.apk","resPackagename":"com.happyelements.AndroidAnimal","resName":"开心消消乐","resIcons":"http://112.124.11.88:8080/mystore/upload/20140711-205516.png","resStatus":1,"resReleasedate":1400496729000,"resUpdatedate":1405092025000,"resVersionCode":11,"resVersion":"1.11","resDownloadnum":20491,"resCapacity":1.67592E7,"resDeveloper":"乐元素","resRated":4,"resCustrated":23,"resCustratednum":7,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":1,"rated2":0,"rated3":4,"rated4":0,"rated5":2,"relatedId":"43,51,524,52,434","resRank":57001,"acId":52,"acName":"开心消消乐"},
    {"resId":793,"resLocation":"http://118.244.202.139/upload/20140712-198501.apk","resPackagename":"com.com2us.acefishing.normal.freefull.google.global.android.common","resName":"钓鱼发烧友","resIcons":"http://112.124.11.88:8080/mystore/upload/20140712-271695.png","resStatus":1,"resReleasedate":1405165796000,"resUpdatedate":1405165927000,"resVersionCode":11,"resVersion":"1.1.1","resDownloadnum":0,"resCapacity":4.25411E7,"resDeveloper":"Com2uS","resRated":3,"resCustrated":0,"resCustratednum":0,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":0,"rated4":0,"rated5":0,"relatedId":"43,129,196,47,270","resRank":0},
    {"resId":89,"resLocation":"http://115.47.4.68/upload/20140416-856730.apk","resPackagename":"org.orangenose.games","resName":"史上最牛的游戏2","resIcons":"http://112.124.11.88:8080/mystore/upload/20140416-856730.png","resStatus":1,"resReleasedate":1375636270000,"resUpdatedate":1397617579000,"resVersionCode":168,"resVersion":"16.8","resDownloadnum":1409,"resCapacity":2.69844E7,"resDeveloper":"远东新世纪科技有限公司","resRated":4,"resCustrated":8,"resCustratednum":2,"resCustratedavg":4.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":0,"rated4":0,"rated5":0,"relatedId":"43,51,524,52,434","resRank":1246},
    {"resId":524,"resLocation":"http://115.47.4.68/upload/20140711-983357.apk","resPackagename":"sh.lilith.dgame.lemon","resName":"刀塔传奇","resIcons":"http://112.124.40.239:8080/mystore/upload/20140711-983357.png","resStatus":1,"resReleasedate":1398145184000,"resUpdatedate":1405065822000,"resVersionCode":17346,"resVersion":"1.10.2","resDownloadnum":21758,"resCapacity":1.09389E8,"resDeveloper":"中清龙图","resRated":3,"resCustrated":33,"resCustratednum":10,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":1,"rated2":0,"rated3":6,"rated4":1,"rated5":2,"relatedId":"43,51,524,52,434","resRank":42138,"acId":48,"acName":"【刀塔传奇】新手大礼包"},
    {"resId":794,"resLocation":"http://118.244.202.119/upload/20140712-728348.apk","resPackagename":"com.fdgentertainment.paperama","resName":"智慧折纸","resIcons":"http://112.124.40.239:8080/mystore/upload/20140712-754854.jpg","resStatus":1,"resReleasedate":1405166265000,"resUpdatedate":1405166357000,"resVersionCode":13,"resVersion":"1.1.0","resDownloadnum":0,"resCapacity":2.97699E7,"resDeveloper":"FDG Entertainment GmbH & Co.KG","resRated":5,"resCustrated":0,"resCustratednum":0,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":0,"rated4":0,"rated5":0,"relatedId":"43,129,196,47,270","resRank":0},
    {"resId":785,"resLocation":"http://118.244.202.182/upload/20140707-371932.apk","resPackagename":"com.ustwo.monumentvalleymh","resName":"纪念碑谷","resIcons":"http://112.124.40.239:8080/mystore/upload/20140707-62430.png","resStatus":1,"resReleasedate":1404723498000,"resUpdatedate":1404723670000,"resVersionCode":2014052023,"resVersion":"4.5.20","resDownloadnum":2,"resCapacity":1.29477E8,"resDeveloper":"First Sight Games ","resRated":5,"resCustrated":5,"resCustratednum":1,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":0,"rated4":0,"rated5":1,"relatedId":"43,129,196,47,270","resRank":0},
    {"resId":281,"resLocation":"http://118.244.202.139/upload/20140625-336862.apk","resPackagename":"com.uwan.lf","resName":"闪电战机2","resIcons":"http://112.124.40.239:8080/mystore/upload/20140116-595138.png","resStatus":1,"resReleasedate":1389807926000,"resUpdatedate":1403702852000,"resVersionCode":122,"resVersion":"1.2.2","resDownloadnum":6774,"resCapacity":3.82381E7,"resDeveloper":"触控科技","resRated":5,"resCustrated":0,"resCustratednum":0,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":0,"rated4":0,"rated5":0,"relatedId":"43,51,524,52,434","resRank":20000},
    {"resId":434,"resLocation":"http://118.244.202.139/upload/20140710-238546.apk","resPackagename":"com.gameloft.android.ANMP.GloftDMCN","resName":"小黄人快跑","resIcons":"http://112.124.40.239:8080/mystore/upload/20140710-238546.png","resStatus":1,"resReleasedate":1396593379000,"resUpdatedate":1404965008000,"resVersionCode":2550000,"resVersion":"2.5.5","resDownloadnum":9544,"resCapacity":5.13683E7,"resDeveloper":"中手游","resRated":4,"resCustrated":37,"resCustratednum":10,"resCustratedavg":0.0,"resRecommendflag":1,"rated1":0,"rated2":0,"rated3":6,"rated4":1,"rated5":3,"relatedId":"43,51,524,52,434","resRank":31187,"acId":56,"acName":"[小黄人快跑]舞者套装礼包"}
];

//ajax填充一个应用的信息，$item是一个zepto对象，itemData提供填充数据
function fillItem($item, itemData)
{
    var packageName = itemData.resPackagename;
    var ca = itemData.resCapacity/(1024*1024);
    //使用包名作为id
    $item.attr("id", itemData.resPackagename)
        .data("location", itemData.resLocation)
        .data("id", itemData.resId)
        .data("package", packageName)
        .data("icon", itemData.resIcons)
        .data("name", itemData.resName)
        .data("capacity", ca);

    bindGiftTapHandler($item, itemData);

    $item.find(".appIcon").data("icon", itemData.resIcons).attr("src", default_icon);

    $item.find(".tit strong").text(itemData.resName);
    $item.find(".tit p").text(ca.toFixed(1) + 'MB | ' + itemData.resDeveloper);

    //评分
    var rated = itemData.resRated;
    fillRate($item, rated);

    //状态
    fillState($item, packageName, phoneData);
}

var default_icon, star_01, star_02, star_03;

$(function()
{
    default_icon = $('.app').eq(0).find(".appIcon").attr("src");
    var $default_stars = $('.items-score').eq(0).find('img');
    star_01 = $default_stars.eq(0).attr('src');
    star_02 = $default_stars.eq(1).attr('src');
    star_03 = $default_stars.eq(2).attr('src');

    $(".app").each(function(i,item)
    {
        var $item = $(this);
        if(product[i])
        {
            fillItem($item, product[i]);
            $item.find(".appIcon").imglazyload({"urlName":"data-icon"});

            //添加点击响应函数
            $item.find(".btn").on("tap",function()
            {
                btnTapHandler($(this));
                return false;
            });
            $item.find(".appInfo").on('tap', function()
            {
                infoTapHandler($(this).parent().parent());
                return false;
            });
        }
        else
        {
            $item.remove();
        }
    });

    $.fn.imglazyload.detect();
});